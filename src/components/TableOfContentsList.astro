---
// Adapted from Starlight (github.com/withastro/starlight)
// Source: https://github.com/withastro/starlight/blob/bf1a9e6fd7311c30b7d1adbecfe9ca32e24207d9/packages/starlight/components/TableOfContents/TableOfContentsList.astro
// Source is licensed under MIT.

import type { TocItem } from '@/utils/generateToC.ts'

interface Props {
	toc: TocItem[];
	depth?: number;
	isMobile?: boolean;
}

const { toc, isMobile = false, depth = 0 } = Astro.props;
---

<ul class:list={{ isMobile }}>
	{
		toc.map((heading) => (
			<li>
				<a href={'#' + heading.slug} class="text-muted-foreground hover:underline">
					<span>{heading.text}</span>
				</a>
				{heading.children.length > 0 && (
					<Astro.self toc={heading.children} depth={depth + 1} isMobile={isMobile} />
				)}
			</li>
		))
	}
</ul>

<style define:vars={{ depth }}>
	ul {
		padding: 0;
		list-style: none;
	}
	a {
		--pad-inline: 0.5rem;
		display: block;
		border-radius: 0.25rem;
		padding-block: 0.25rem;
		padding-inline: calc(1rem * var(--depth) + var(--pad-inline)) var(--pad-inline);
		line-height: 1.5;
	}
	a[aria-current='true'] {
		color: var(--sl-color-text-accent);
	}
	.isMobile a {
		--pad-inline: 1rem;
		display: flex;
		justify-content: space-between;
		gap: var(--pad-inline);
		border-top: 1px solid var(--sl-color-gray-6);
		border-radius: 0;
		padding-block: 0.5rem;
		color: var(--sl-color-text);
		font-size: var(--sl-text-sm);
		text-decoration: none;
		outline-offset: var(--sl-outline-offset-inside);
	}
</style>

{ depth === 0 && <script is:inline>
  document.addEventListener("astro:page-load", () => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        const id = entry.target.id;
        const header = document.querySelector(`li a[href="#${id}"]`);
        if (header === null) {
          console.log(id);
          return;
        }

        if (entry.intersectionRatio > 0) {
          header.classList.remove("text-muted-foreground");
        } else {
          header.classList.add("text-muted-foreground");
        }
      });
    });

    document.querySelectorAll("section[id]").forEach((section) => {
      observer.observe(section);
    });
  });
</script> }
